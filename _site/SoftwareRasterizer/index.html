<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--> <!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"><!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"> <title>Code Drawing World: Create PBR Software Rasterizer &#8211; Silver Gamer</title> <meta name="description" content="That which does not kill us makes us stronger."> <meta name="keywords" content="Graphics Pipeline, oftware Rasterizer, PBR"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:image" content="https://raw.githubusercontent.com/OneSilverBullet/SilverGamer.GitHub.io/gh-pages/_img/blogHead/SoftR.png"> <meta name="twitter:title" content="Code Drawing World: Create PBR Software Rasterizer"> <meta name="twitter:description" content="Create PBR Software Rasterizer from One Line C++ Code."> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Code Drawing World: Create PBR Software Rasterizer"> <meta property="og:description" content="Create PBR Software Rasterizer from One Line C++ Code."> <meta property="og:url" content="https://onesilverbullet.github.io/SilverGamer.GitHub.io/SoftwareRasterizer/"> <meta property="og:site_name" content="Silver Gamer"> <meta property="og:image" content="https://onesilverbullet.github.io/SilverGamer.GitHub.io/assets/img/logo.png"> <link rel="canonical" href="https://onesilverbullet.github.io/SilverGamer.GitHub.io/SoftwareRasterizer/"> <link href="https://onesilverbullet.github.io/SilverGamer.GitHub.io/feed.xml" type="application/atom+xml" rel="alternate" title="Silver Gamer Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="https://onesilverbullet.github.io/SilverGamer.GitHub.io/assets/css/main.css"> <!-- JS --> <script src="https://onesilverbullet.github.io/SilverGamer.GitHub.io/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="https://onesilverbullet.github.io/SilverGamer.GitHub.io/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="https://onesilverbullet.github.io/SilverGamer.GitHub.io/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="https://onesilverbullet.github.io/SilverGamer.GitHub.io/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="https://onesilverbullet.github.io/SilverGamer.GitHub.io/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="https://onesilverbullet.github.io/SilverGamer.GitHub.io/favicon.png" /> <link rel="shortcut icon" href="https://onesilverbullet.github.io/SilverGamer.GitHub.io/favicon.ico" /> <!-- Background Image --> <style type="text/css">body {background-image:url(https://onesilverbullet.github.io/SilverGamer.GitHub.io/assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> <style type="text/css">.feature {background-image:url(https://raw.githubusercontent.com/OneSilverBullet/SilverGamer.GitHub.io/gh-pages/_img/blogHead/SoftR.png);}</style> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="https://onesilverbullet.github.io/SilverGamer.GitHub.io/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="https://onesilverbullet.github.io/SilverGamer.GitHub.io/assets/img/logo.png" alt="Silver Gamer photo" class="author-photo"> <h4>Silver Gamer</h4> <p>That which does not kill us makes us stronger.</p> </li> <li><a href="https://onesilverbullet.github.io/SilverGamer.GitHub.io/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="http://github.com/OneSilverBullet?tab=repositories" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul><!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="https://onesilverbullet.github.io/SilverGamer.GitHub.io/posts/">All Posts</a></li> <li><a href="https://onesilverbullet.github.io/SilverGamer.GitHub.io/tags/">All Tags</a></li> </ul> </li> <li><a href="https://onesilverbullet.github.io/SilverGamer.GitHub.io/projects/" >Projects</a></li> <li><a href="https://onesilverbullet.github.io/SilverGamer.GitHub.io/blog/" >Blog</a></li> </ul><!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title feature "> <h1>Code Drawing World: Create PBR Software Rasterizer</h1> <h4>07 Oct 2021</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~1 minute </p><!-- /.entry-reading-time --> <a class="btn zoombtn" href="https://onesilverbullet.github.io/SilverGamer.GitHub.io/projects/"> <i class="fa fa-chevron-left"></i> </a> </div> <center>God said, "Let there be light," and there was light.</center> <h3 id="序言光栅化对图形学的重要意义">序言：光栅化对图形学的重要意义</h3> <p>对我而言，图形学是一门创建虚拟世界的学问。目前的3A级别游戏是图形学登峰造极水平的最佳示例。上古卷轴系列为我们展现了白金塔下绝美的风景，巫师在惨淡的夕阳下给我们展现了一个人类与怪物共存的世界……游戏制作人在虚拟世界中尽情发挥自己的奇思妙想，让全世界各个角落的人们可以体验到完全不同的人生。这一切都归功于基于GPU的图形学技术的突破与发展。在我看来，图形学技术的研究者无异于世界的开发者，他们殚精竭虑考虑如何能够更好的模拟、创建一个更好的世界，如同创世者一般。而这也是我选择游戏引擎开发作为我的职业的原因。</p> <p>如今图形学领域的知识瞬息万变。得益于GPU硬件技术的不断突破，实时光线追踪、动态全局光照的进展一日千里。每天都有实时性更好、性能更佳的新算法出现。而正如古语所云，罗马并非一日建成。理解图形学的基础算法对学习最新算法非常重要，而其中最为重要的算法就是光栅化算法。</p> <p>光栅化算法的作用是我们所设计的虚拟物体映射到二维平面上，这个算法是近20年来几乎所有实时图形学算法的基石。 如今，这种算法被编码于GPU硬件当中，OpenGL与DirectX都有相关的接口可以调用。虽然光栅化算法已然成为了新生代程序员的“神的恩赐”，但是其思想仍然深刻地影响着业界。2016年的Siggraph中，光栅化思想被应用于场景物体的遮挡剔除<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>；保守光栅化思想是时间抗锯齿<sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup>的重要组成部分……</p> <p>光栅化算法是一些游戏公司中引擎程序的培训项目。掌握光栅化算法是开启图形学大门的钥匙，这是我撰写此文的原因。本文详细阐述了光栅化思想，并提供一种光栅化算法在CPU端的实现。希望能够帮到需要的新人们。下面是软渲染器的代码链接：</p> <iframe src="https://github.com/OneSilverBullet/SilverGL-Soft_Render_Pipline" frameborder="0" scrolling="0" width="160px" height="30px"></iframe> <p>如果这篇文章帮到你了，请给我的项目一个Star。谢谢观赏。</p> <h3 id="概述">概述</h3> <p>我们分为五个部分对光栅化相关内容进行分析。首先，我们来看一看渲染的流程，了解为什么要使用这一套流程来进行渲染。其次，我们将会介绍重心坐标法，这是光栅化算法的核心内容。在第三节介绍扫描线算法以及三角形裁剪算法，我们将会了解到光栅化算法的优化方案。在第四节，我们将介绍基于物理的渲染，我们会了解到每一个像素是如何着色的。最后我们将展示软光栅算法的效果与总结。在每一节中都提供了详尽的实现代码。</p> <ul> <li>渲染管线原理</li> <li>重心坐标法</li> <li>扫描线算法及三角形裁剪</li> <li>光照模型：基于物理的渲染</li> <li>效果与总结</li> </ul> <h3 id="1渲染管线原理">1.渲染管线原理</h3> <p>光栅化算法是基于一个反直觉的渲染流程运行的。认真的说，实时渲染管线的内容是比较违背人类直觉的，而光线追踪框架更加符合人类的直观感受。然而，迫于GPU性能的限制，过去二十年里，光线追踪渲染框架并未成为游戏引擎的通用解决方案。实时渲染管线脱颖而出，而光栅化算法成为了实时图形学应用的唯一解决方案。为了深入理解光栅化算法，了解实时渲染管线的流程至关重要。</p> <figure> <a href="https://raw.githubusercontent.com/OneSilverBullet/SilverGamer.GitHub.io/gh-pages/_img/SoftRFig/RenderPipeline.png"><img src="https://raw.githubusercontent.com/OneSilverBullet/SilverGamer.GitHub.io/gh-pages/_img/SoftRFig/RenderPipeline.png" align="center" /></a> <figcaption>Render Pipeline in our Software Rasterizer.</figcaption> </figure> <p>我们所设计的软光栅程序的渲染管线如上图所示。整个渲染流程由四个阶段构成：设计场景、顶点变换、三角形组装、光栅化。</p> <p>试想一下，我们现在要渲染一个漂亮的场景，首先需要艺术家们通过3DMax、Maya等软件创建相应的场景模型。场景模型通常由大量顶点构成，而顶点由顶点属性描述。例如顶点的position，normal，uv以及构成每一个三角形所需要的三个顶点索引值。我们将渲染管线的整体视为一个函数，而这些顶点属性所构成的数据集合，就是这个函数的输入值。因此，设计场景是确定渲染管线输入的关键阶段，通常由团队中的艺术家完成这一阶段。</p> <p>以.obj文件为例，</p><pre><code class="language-C++">

</code></pre><h3 id="2重心坐标法">2.重心坐标法</h3> <figure> <a href="https://raw.githubusercontent.com/OneSilverBullet/SilverGamer.GitHub.io/gh-pages/_img/SoftRFig/BCM.png"><img src="https://raw.githubusercontent.com/OneSilverBullet/SilverGamer.GitHub.io/gh-pages/_img/SoftRFig/BCM.png" align="center" /></a> <figcaption>Barycentric Coordinate Method.</figcaption> </figure> <h3 id="3扫描线算法及三角形裁剪">3.扫描线算法及三角形裁剪</h3> <figure> <a href="https://raw.githubusercontent.com/OneSilverBullet/SilverGamer.GitHub.io/gh-pages/_img/SoftRFig/Scanline.png"><img src="https://raw.githubusercontent.com/OneSilverBullet/SilverGamer.GitHub.io/gh-pages/_img/SoftRFig/Scanline.png" align="center" /></a> <figcaption>Scanline Method.</figcaption> </figure> <figure> <a href="https://raw.githubusercontent.com/OneSilverBullet/SilverGamer.GitHub.io/gh-pages/_img/SoftRFig/TriCutting.png"><img src="https://raw.githubusercontent.com/OneSilverBullet/SilverGamer.GitHub.io/gh-pages/_img/SoftRFig/TriCutting.png" align="center" /></a> <figcaption>Triangular Cutting.</figcaption> </figure> <h3 id="4光照模型基于物理的渲染">4.光照模型：基于物理的渲染</h3> <figure> <a href="https://raw.githubusercontent.com/OneSilverBullet/SilverGamer.GitHub.io/gh-pages/_img/SoftRFig/PBR.png"><img src="https://raw.githubusercontent.com/OneSilverBullet/SilverGamer.GitHub.io/gh-pages/_img/SoftRFig/PBR.png" align="center" /></a> <figcaption>PBR Material.</figcaption> </figure> <h3 id="5效果与总结">5.效果与总结</h3> <h3 id="额外阅读">额外阅读</h3> <div class="footnotes"> <ol> <li id="fn:1"> <p><a href="https://dl.acm.org/doi/abs/10.5555/2977336.2977340">https://dl.acm.org/doi/abs/10.5555/2977336.2977340</a> <a href="#fnref:1" class="reversefootnote">&#8617;</a></p> </li> <li id="fn:2"> <p><a href="http://alextardif.com/TAA.html">http://alextardif.com/TAA.html</a> <a href="#fnref:2" class="reversefootnote">&#8617;</a></p> </li> </ol> </div> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="https://onesilverbullet.github.io/SilverGamer.GitHub.io/tags/#Graphics Pipeline" title="Pages tagged Graphics Pipeline" class="tag"><span class="term">Graphics Pipeline</span></a><a href="https://onesilverbullet.github.io/SilverGamer.GitHub.io/tags/#oftware Rasterizer" title="Pages tagged oftware Rasterizer" class="tag"><span class="term">oftware Rasterizer</span></a><a href="https://onesilverbullet.github.io/SilverGamer.GitHub.io/tags/#PBR" title="Pages tagged PBR" class="tag"><span class="term">PBR</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=https://onesilverbullet.github.io/SilverGamer.GitHub.io/SoftwareRasterizer/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Share</span> </a> <a href="https://twitter.com/intent/tweet?text=https://onesilverbullet.github.io/SilverGamer.GitHub.io/SoftwareRasterizer/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=https://onesilverbullet.github.io/SilverGamer.GitHub.io/SoftwareRasterizer/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> <section id="disqus_thread" class="animated fadeInUp"></section><!-- /#disqus_thread --> </header> <!-- JS --> <script src="https://onesilverbullet.github.io/SilverGamer.GitHub.io/assets/js/jquery-1.12.0.min.js"></script> <script src="https://onesilverbullet.github.io/SilverGamer.GitHub.io/assets/js/jquery.dlmenu.min.js"></script> <script src="https://onesilverbullet.github.io/SilverGamer.GitHub.io/assets/js/jquery.goup.min.js"></script> <script src="https://onesilverbullet.github.io/SilverGamer.GitHub.io/assets/js/jquery.magnific-popup.min.js"></script> <script src="https://onesilverbullet.github.io/SilverGamer.GitHub.io/assets/js/jquery.fitvid.min.js"></script> <script src="https://onesilverbullet.github.io/SilverGamer.GitHub.io/assets/js/scripts.js"></script> <script type="text/javascript"> var disqus_shortname = 'taylantatli'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
